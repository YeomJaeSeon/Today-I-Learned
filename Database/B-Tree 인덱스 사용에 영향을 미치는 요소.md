# B-Tree 인덱스 사용에 영향을 미치는 요소
- B-Tree 인덱스는 인덱스를 구성하는 칼럼의 크기, 레코드 건수, 유니크한 인덱스 키 값의 개수등에 의해 검색, 변경에 대한 성능이 영향을 받는다.
(칼럼의 크기가 크면 한 페이지안에 존재할수있는 레코드수가 적어질것이고, 한 페이지로 검색할수있는게 두개의 페이지를 검색해야해서 성능이 안좋아질거같고, 또, 이노디비 버퍼풀같은 제한된 영역을 사용하기 힘들어질테니 성능이 안좋아질거고..
레코드 건수가 많아지면, 칼럼의 크기가 주는 영향과 비슷한 영향을 줄 것 같은데, 유니크 인덱스 키 값의 개수는 무슨 영향이있쮜?)

## 인덱스 키 값의 크기
- B-Tree의 B는 Binary X, Balance O
  - 이진트리라면 한 페이지안에 레코드가 두개만 존재하기에 비효율적일것임.
- 한 페이지안에 레코드 몇개존재가능?
  - `show variables  like '%innodb_page_size%'`로 시스템 변수로 설정된, 페이지 사이즈를 알수있다.(난 16kb)
  - 그럼 한 레코드의 크기에 따라 몇개의 노드가 존재하는지는 알수 있따. (16 * 1024) / (한 레코드 크기)
- 당연히 칼럼의 크기가 커서, 한 레코드의 크기가 커지면 그만큼 한 페이지안에 존재할수있는 노드의 개수는 적어진다.

-> 한페이지에 존재할수있던 동일한 수의 레코드가 이젠 두 페이진, 세 페이지 이상으로 쪼개져야하며, 조회할때, 세 페이지를 모두 사용해야해서, 성능이 떨어진다.
-> 버퍼풀과 같은 메모리는 제한적이기에 하나의 레코드의 크기가 커지면 그만큼 메모리에 저장할수있는 레코드 개수가 적어지기에 효율적이지 못하다.

## B-Tree depth
- depth란 루트 노드 - 브랜치 노드 - 리프 노드의 depth이고, 브랜치노드는 있을수도 있고 없을수도있어서 depth가 크다는건 브랜치 노드들의 depth가 여러개란 의미이다.
- 인덱스 키 값의 크기가 커지면 당연히 한 페이지에 존재할 데이터들이 여러페이지로 존재해야하며, 여러 페이지로 나누어지고 더 필요하다면 브랜치노드의 depth도 추가로 생긴다.
- B-Tree의 depth가 커지면, 디스크 i/o가 더 많이 필요하다는 의미이고 성능에 악영향을 끼친다.

## 선택도(기수성=카디널리티)
- 유니크한 값의 수를 의미한다.
  - 전체 100개의 인덱스 레코드 중
    - 유니크한값이 10개라면 카디널리티 10(기수성)
    - 유니크한값이 99개라면 카디널리티 99(기수성)
- 유니크한 값의 수(기수성 = 카디널리티)가 클 수록, 중복된값이 줄어들어, 검색 대상이 줄어들기에 더 효율적이다.
  - 총 1억개의 레코드가 존재하는 테이블에 남/녀의 데이터만 가지고 있는 gender칼럼을 인덱스 키로 만들어 조회를 해도 카디널리티가 2라서, 중복된 값이 너무 많아 검색대상이 많기에 검색이 오래걸린다.
  - 총 1억개의 레코드가 존재하는 테이블에 유니크한 id는 카디널리티가 1억이고, 해당 인덱스키로 조회하면 중복된값이 하나도 없어 검색대상이 적기에 금방 검색한다.

-> **유니크한 값의 개수는 인덱스나 쿼리의 효율성에 큰 영향을 미친다.**

## 읽어야할 레코드의 개수
- 테이블의 전체 레코드 개수가 아니라, 읽어야할 레코드의 개수이다.
- 인덱스를 통해 테이블의 레코드를 읽는 것의 cost > 인덱스 통하지 않고 테이블의 레코드 읽는 것의 cost
  - 인덱스를 통해 테이블의 레코드를 읽는 것은 인덱스 B-Tree를 통해 조회하는 것이기에 cost가 크다. (무조건 인덱스로 검색하는 게 빠른지알았숨.)
- 1억개의 레코드가 있는 테이블에 5000만개의 레코드를 읽어야한다면 인덱스를 통해서 읽는게 빠를가 아니면 인덱스 통하지 않고 읽는게 빠를까?
  - 옵티마이저는 보통 인덱스를 통해 1개 레코드 읽는 것이 인덱스 통하지 않고 바로 테이블에서 레코드 1개읽는 것보다 4~5배 cost 가 든다 판단한다.
- **보통 테이블의 전체 레코드 개수중 20~25% 이상의 레코드를 읽을 떈, 인덱스를 사용해서 읽는 것보다 전체 테이블에서 모두 읽고 필터링하는 것이 더 빠르다**
  - 물론 1억개중 10개를 읽어야할땐, 인덱스를 통해서 읽는게 훨씬 빠르다. (10개를 필터링하는 작업이 인덱스를 통해서 읽는것보다 너어어무 오래걸리닌까.)
