# 접속동작의 실제
- `connect(디스크립터, 서버측의 ip주소 및 포트번호, ...)`함수가 호출 되었을 때 어떤일들이 일어나는지 알아보자.

<클라이언트 -> 서버>
1. 데이터 송,수신 개시를 나타내는 제어정보를 기록한 헤더를 만든다.
2. 클라이언트의 소켓을 지정하고 SYN이라는 비트를 1로 만든다. (TCP헤더에 기록)
    - 헤더에는 송신처와 수신처의 포트번호가 있는데, 이를 통해 송신처의 소켓과 수신처의 소켓을 지정할 수 있다.
3. 만들어진 TCP 헤더를 클라이언트 IP 담당 부분에 건네주어 송신의뢰
4. 클라이언트 IP담당 부분이 패킷 송신하여 서버에 도착
5. 서버측 IP담당 부분이 패킷을 받아 서버측 TCP 담당 부분으로 전달
6. 서버측 TCP담당 부분은 전달받은 패킷의 TCP헤더를 조사하여 기록된 수신처 포트번호를 통해 서버의 소켓 지정
   - 접속 기다리는 소켓중 전달받은 TCP헤더의 수신처 포트 번호와 같은 번호가 기록된 것이 지정할 서버 소켓
7. 서버측 소켓이 지정 후, 해당 소켓에 필요한 정보 기록 및 "진행중"이라는 상태를 소켓에 기록

<서버 -> 클라이언트>

8. 서버도 클라이언트와 마찬가지로 제어 정보를 기록한 헤더 만든다.
9. 서버 소켓 지정후 SYN이라는 비트 1로 만들어 TCP 헤더에 기록
10. ACK비트도 1로 만들어 TCP헤더에 기록
11. 만들어진 TCP 헤더를 서버 IP 담당 부분에 건네주어 송신의뢰
12. 서버측 IP 담당부분이 패킷 송신하여 클라이언트에 도착
13. 클라이언트측 IP담당 부분은 패킷 받아 클라이언트측 TCP 담당 부분으로 전달
14. 클라이언트 측 TCP담당 부분은 전달받은 패킷의 TCP 헤더를 조사하여 기록된 수신처 포트번호를 통해 클라이언트 소켓지정
    - 접속 기다리는 소켓 중 전달받은 TCP헤더의 수신처 포트번호와 같은 번호가 기록된 것이 지정할 클라이언트 소켓
15. 클라이언트측 소켓 지정 후, 해당 TCP헤더를 조사하여 필요한 정보 소켓에 기록
    - SYN 1이면 접속 성공이므로 소켓에 "접속 완료 기록"

> 여기서 끝난게 아니다. 클라이언트는 서버에서 전달한 ACK 비트1이 클라이언트에 잘 도착했다고 다시 서버에 알리기 위해, ACK 비트를 1을 적은 TCP 헤더를 다시 서버에 반송해야한다.
> "ACK은 패킷을 잘 받았다는 것을 알려주기 위해 사용되는 TCP 헤더 비트"

- 위 과정들로 **소켓은 데이터를 송, 수신 할 수 있는 상태가 되는 것이다.**
- 파이프와같은 통로를 **커넥션**이라고 한다.
  - 커넥션은 데이터 송수신 하는 동안 계속 존재한다.(**close**함수 호출하여 커넥션 종료하기 전까지..)
- **커넥션이 만들어지면 프로토콜 스택의 접속 과정이 종료된다.**
