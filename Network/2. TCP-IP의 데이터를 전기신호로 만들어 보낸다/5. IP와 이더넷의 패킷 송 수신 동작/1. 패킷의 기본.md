# 패킷의 기본

- TCP는 통신 상대와 대화할 때, IP에게 데이터 송신해달라고 의뢰하고 ip는 패킷을 상대에게 전달한다. 
- 의뢰받은 IP는 패킷을 어떻게 상대방에게 송신할까?

## 패킷의 구조
- '헤더', '데이터' 두부분으로 구성되어있음
  - 헤더: 제어정보 (택배의 전표)
  - 데이터: 의뢰처에서 의뢰한 데이터 (택배의 내용물)
- ![패킷의 모습.png](images%2F%ED%8C%A8%ED%82%B7%EC%9D%98%20%EB%AA%A8%EC%8A%B5.png)

## 패킷 전달 과정
1. 패킷 송신
2. ip주소를 통해 목적지가 어떤 방향에 있는지 조사
3. 이더넷은 ip주소를 통해 MAC주소를 찾아(ARP) 해당방향의 중계장치가 뭔지 조사 (동일 네트워크 대역 내에선 ip주소가 아니라 mac주소를 통해 다음 중계장치에 데이터 송신한다.)
4. 다음 중계장치에 데이터 전달
5. 중계장치는 다시 IP헤더의 IP주소를 통해 목적지가 어떤 방향에 있는지 조사
6. 이더넷은 ip주소를 통해 MAC주소를 찾아(ARP) 해당방향의 중계장치가 뭔지 조사 (동일 네트워크 대역 내에선 ip주소가 아니라 mac주소를 통해 다음 중계장치에 데이터 송신한다.)
7. ... 반복
8. 최종 수신지까지 반복

- 보통 수신처가 받으면 송신처로 회답하기 때문에 송신처 수신처를 구분하지 않고 두개를 묶어서 **엔드 노드**라고 한다.

## 두가지 중계장치
1. 허브: 이더넷의 규칙에 따라 패킷 운반 = 서브넷 안에 있는 이더넷이 다음 중계장치 까지 패킷 운반
2. 라우터: ip 규칙에 따라 패킷 운반 = ip가 목적지 확인하여 다음 ip의 중계장치를 나타낸다.

## ip는 두가지 헤더를 추가한다
- ip는 tcp로부터 의뢰받은 패킷에 대해 두가지 헤더를 추가한다.
1. MAC헤더
   - 허브가 서브넷(동일 네트워크 대역 = 동일한 네트워크 주소) 안에서 패킷을 운반하여 다음 라우터에 도착하기 위한 제어정보
   - 서브넷(동일 네트워크 대역 = 동일한 네트워크 주소) 안에 있는 이더넷이 중계 장치까지 패킷을 운반하기 위한 제어정보
2. IP헤더
   - 라우터가 목적지를 확인하여 다음 라우터를 나타내기 위한 제어정보
   - IP가 목적지를 확인하여 다음 IP의 중계 장치를 나타내기 위한 제어정보

## IP와 이더넷은 왜 역할을 분담할까?
- 역할을 분담해야 대체가능성이 가능하기 때문이다. 
- ip는 이더넷부분을 무선 LAN, LAN, ADSL등, **ip의뢰를 받아 패킷을 전달할수 있는 것이면 무엇이든** 사용할수 있다.
- ip는 패킷 전달을 의뢰할뿐 상대가 누군지, 내부적으로 어떻게 구현되어있는지, 뭔지는 관심없다. 그래야 대체가능성이 가능하다.